//! openseadragonimaginghelper 2.0.0
//! Build date: 2018-12-20
//! Git commit: v2.0.0-1-886fb29
//! https://github.com/msalsbery/OpenSeadragonImagingHelper

!function(t,e,i){if(!t.version||t.version.major<2)throw new Error("OpenSeadragonImagingHelper requires OpenSeadragon version 2.0.0+");t.Viewer.prototype.activateImagingHelper=function(i){this.imagingHelper||(((i=i||{}).viewer=this).imagingHelper=new e.ImagingHelper(i));return this.imagingHelper};e.ImagingHelper=function(i){if(!(i=i||{}).viewer)throw new Error("A viewer must be specified.");if(i.viewer.imagingHelper)throw new Error("Viewer already has an ImagingHelper.");this._viewer=i.viewer;t.EventSource.call(this);(this._viewer.imagingHelper=this).options=i;this.imgWidth=0;this.imgHeight=0;this.imgAspectRatio=0;this._zoomFactor=1;this._minZoom=.001;this._maxZoom=10;this._zoomStepPercent=30;this._haveImage=!1;this._viewerSize=null;this._viewportWidth=0;this._viewportHeight=0;this._viewportOrigin=new OpenSeadragon.Point(0,0);this._viewportCenter=new OpenSeadragon.Point(0,0);i.onImageViewChanged&&this.addHandler("image-view-changed",i.onImageViewChanged);this._viewer.addHandler("open",t.delegate(this,n));this._viewer.addHandler("close",t.delegate(this,r));this._viewer.addHandler("animation",t.delegate(this,a));this._viewer.addHandler("animation-finish",t.delegate(this,h));this._viewer.addHandler("resize",t.delegate(this,s));this._viewer.addHandler("full-page",t.delegate(this,g));this._viewer.addHandler("full-screen",t.delegate(this,m))};e.ImagingHelper.version={versionStr:"2.0.0"};var o=e.ImagingHelper.version.versionStr.split(".");e.ImagingHelper.version.major=parseInt(o[0],10);e.ImagingHelper.version.minor=parseInt(o[1],10);e.ImagingHelper.version.revision=parseInt(o[2],10);t.extend(e.ImagingHelper.prototype,t.EventSource.prototype,{_raiseImageViewChanged:function(){this.raiseEvent("image-view-changed",{viewportWidth:this._viewportWidth,viewportHeight:this._viewportHeight,viewportOrigin:this._viewportOrigin,viewportCenter:this._viewportCenter,zoomFactor:this._zoomFactor})},_trackZoomPan:function(){var i=this._viewer.viewport.getBounds(!0);this._viewportOrigin.x=i.x;this._viewportOrigin.y=i.y*this.imgAspectRatio;this._viewportWidth=i.width;this._viewportHeight=i.height*this.imgAspectRatio;this._viewportCenter.x=this._viewportOrigin.x+this._viewportWidth/2;this._viewportCenter.y=this._viewportOrigin.y+this._viewportHeight/2;this._zoomFactor=this.getViewerContainerSize().x/(this._viewportWidth*this.imgWidth);this._raiseImageViewChanged()},getViewerContainerSize:function(){var i=this._viewer.container;return new t.Point(i.clientWidth,i.clientHeight)},notifyResize:function(){var i,t,e;if(this._haveImage&&!(i=this.getViewerContainerSize()).equals(this._viewerSize)){this._viewerSize=i;t=new OpenSeadragon.Point(this._viewportCenter.x,this._viewportCenter.y/this.imgAspectRatio);e=this._zoomFactor;this._viewer.viewport.resize(i,!1);this._viewer.viewport.zoomTo(e*this.imgWidth/i.x,null,!0);this._viewer.viewport.panTo(t,!0);this._raiseImageViewChanged()}},getMinZoom:function(){return this._minZoom},setMinZoom:function(i){this._minZoom=i;this._viewer.minZoomLevel=i*this.imgWidth/this.getViewerContainerSize().x},getMaxZoom:function(){return this._maxZoom},setMaxZoom:function(i){this._maxZoom=i;this._viewer.maxZoomLevel=i*this.imgWidth/this.getViewerContainerSize().x},getZoomStepPercent:function(){return this._zoomStepPercent},setZoomStepPercent:function(i){this._zoomStepPercent=i},setView:function(i,t,e,o){if(this._haveImage){this._viewportWidth===i&&this._viewportHeight===t||this._viewer.viewport.zoomTo(1/i,null,o);this._viewportCenter.x===e.x&&this._viewportCenter.y===e.y||this._viewer.viewport.panTo(new OpenSeadragon.Point(e.x,e.y/this.imgAspectRatio),o)}},getZoomFactor:function(){return this._zoomFactor},setZoomFactor:function(i,t){this._haveImage&&i!==this._zoomFactor&&0<i&&this._viewer.viewport.zoomTo(i*this.imgWidth/this.getViewerContainerSize().x,new OpenSeadragon.Point(this._viewportCenter.x,this._viewportCenter.y/this.imgAspectRatio),t)},zoomIn:function(i){var t=this._zoomFactor;(t*=1+this._zoomStepPercent/100)>this._maxZoom&&(t=this._maxZoom);this.setZoomFactor(t,i)},zoomOut:function(i){var t=this._zoomFactor;(t/=1+this._zoomStepPercent/100)<this._minZoom&&(t=this._minZoom);this.setZoomFactor(t,i)},zoomAboutLogicalPoint:function(i,t,e){this._haveImage&&i!==this._zoomFactor&&0<i&&this._viewer.viewport.zoomTo(i*this.imgWidth/this.getViewerContainerSize().x,new OpenSeadragon.Point(t.x,t.y/this.imgAspectRatio),e)},zoomInAboutLogicalPoint:function(i,t){var e=this._zoomFactor;(e*=1+this._zoomStepPercent/100)>this._maxZoom&&(e=this._maxZoom);this.zoomAboutLogicalPoint(e,i,t)},zoomOutAboutLogicalPoint:function(i,t){var e=this._zoomFactor;(e/=1+this._zoomStepPercent/100)<this._minZoom&&(e=this._minZoom);this.zoomAboutLogicalPoint(e,i,t)},centerAboutLogicalPoint:function(i,t){!this._haveImage||this._viewportCenter.x===i.x&&this._viewportCenter.y===i.y||this._viewer.viewport.panTo(new OpenSeadragon.Point(i.x,i.y/this.imgAspectRatio),t)},physicalToLogicalPoint:function(i){return new OpenSeadragon.Point(this.physicalToLogicalX(i.x),this.physicalToLogicalY(i.y))},logicalToPhysicalPoint:function(i){return new OpenSeadragon.Point(this.logicalToPhysicalX(i.x),this.logicalToPhysicalY(i.y))},physicalToLogicalX:function(i){return this._haveImage?this._viewportOrigin.x+i/this.getViewerContainerSize().x*this._viewportWidth:0},physicalToLogicalY:function(i){return this._haveImage?this._viewportOrigin.y+i/this.getViewerContainerSize().y*this._viewportHeight:0},logicalToPhysicalX:function(i){return this._haveImage?(i-this._viewportOrigin.x)/this._viewportWidth*this.getViewerContainerSize().x:0},logicalToPhysicalY:function(i){return this._haveImage?(i-this._viewportOrigin.y)/this._viewportHeight*this.getViewerContainerSize().y:0},physicalToLogicalDistance:function(i){return this._haveImage?i/this.getViewerContainerSize().x*this._viewportWidth:0},logicalToPhysicalDistance:function(i){return this._haveImage?i/this._viewportWidth*this.getViewerContainerSize().x:0},logicalToDataPoint:function(i){return new OpenSeadragon.Point(this.logicalToDataX(i.x),this.logicalToDataY(i.y))},dataToLogicalPoint:function(i){return new OpenSeadragon.Point(this.dataToLogicalX(i.x),this.dataToLogicalY(i.y))},physicalToDataPoint:function(i){return new OpenSeadragon.Point(this.physicalToDataX(i.x),this.physicalToDataY(i.y))},dataToPhysicalPoint:function(i){return new OpenSeadragon.Point(this.dataToPhysicalX(i.x),this.dataToPhysicalY(i.y))},logicalToDataX:function(i){return this._haveImage?i*this.imgWidth:0},logicalToDataY:function(i){return this._haveImage?i*this.imgHeight:0},dataToLogicalX:function(i){return this._haveImage&&0<this.imgWidth?i/this.imgWidth:0},dataToLogicalY:function(i){return this._haveImage&&0<this.imgHeight?i/this.imgHeight:0},physicalToDataX:function(i){return this._haveImage&&0<this.getViewerContainerSize().x?(this._viewportOrigin.x+i/this.getViewerContainerSize().x*this._viewportWidth)*this.imgWidth:0},physicalToDataY:function(i){return this._haveImage&&0<this.getViewerContainerSize().y?(this._viewportOrigin.y+i/this.getViewerContainerSize().y*this._viewportHeight)*this.imgHeight:0},dataToPhysicalX:function(i){return this._haveImage&&0<this.imgWidth?(i/this.imgWidth-this._viewportOrigin.x)/this._viewportWidth*this.getViewerContainerSize().x:0},dataToPhysicalY:function(i){return this._haveImage&&0<this.imgHeight?(i/this.imgHeight-this._viewportOrigin.y)/this._viewportHeight*this.getViewerContainerSize().y:0}});function n(){this._haveImage=!0;var i,t={};if(this._viewer.viewport.contentSize)i=this._viewer.viewport.contentSize;else{var e=this._viewer.world.getHomeBounds();t.x=e.width-e.x;t.y=e.height-e.y;var o=parseInt(this.options.worldIndex,10)||0;i=this._viewer.world.getItemAt(o).viewportToImageCoordinates(t.x,t.y)}this.imgWidth=i.x;this.imgHeight=i.y;this.imgAspectRatio=this.imgWidth/this.imgHeight;this._trackZoomPan()}function r(){this._haveImage=!1;this.imgWidth=0;this.imgHeight=0;this.imgAspectRatio=0}function a(){this._trackZoomPan()}function h(){this._trackZoomPan()}function s(){this._viewer&&this._viewer.autoResize&&this._trackZoomPan()}function g(){this._trackZoomPan()}function m(){this._trackZoomPan()}}(OpenSeadragon,window.OpenSeadragonImaging=window.OpenSeadragonImaging||{});